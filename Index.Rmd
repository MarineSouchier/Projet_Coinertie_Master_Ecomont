---
title: "Projet Coinertie / Master 2 ECOMONT"
author: "Marine Souchier"
date: "`r Sys.Date()`"
output: 
  rmdformats::readthedown:
    highlight: kate
    number_sections: TRUE
    tableOfContents: {
      minHeadingLevel: 3,
      maxHeadingLevel: 5,
      
    }
    df_print: kable
---

Ce projet est réalisé dans le cadre du Master 2 ECOMONT et porte sur l'étude de coinertie entre des données de dominances végétales et des paramètres abiotiques collectés sur 52 quadrats du site d'ARAVO en 2022 (seules les données SMOC datent de 1997 à 1999).

# Chargement des librairies
***

```{r message=FALSE, warning=FALSE}
library(tidyverse)
library(corrplot)
library(ade4)
library(kableExtra)
library(knitr)
library(splines)
library(plotly)
library(DT)
library(Hmisc)
library(FactoMineR)
library(factoextra)
```

# Import et description du jeu de données
***

## Import du tableau des espèces

```{r, echo=FALSE, fig.cap="Tableau 1: Tableau des espèces."}
setwd(".")
spe <- read.csv2('Especes.csv', row.names = 1)
datatable(spe, rownames = FALSE, filter="top", options = list(pageLength = 5, scrollX=T))
```
Le tableau des espèces rassemble les informations de présence/absence d'espèces en tant qu'espèces dominantes sur 53 quadrats de 1 m sur 1 m réalisés sur le site d'ARAVO.

## Import du tableau abiotique

```{r, echo=FALSE, fig.cap="Tableau 2: Tableau abiotique."}
setwd(".")
env <- read.csv2('Abiotique2.csv', dec = ".", row.names = 1)
datatable(env, rownames = TRUE, filter="top", options = list(pageLength = 5, scrollX=T))
```

Le tableau abiotique rassemble les paramètres abiotiques associés aux 52 quadrats à savoir:
<br>
-l'Aspect = la direction horizontale de la pente. 0° signifie que la pente est face au Nord, 90° face à l’Est, 180° face au sud et 270° face à l’Ouest.
<br>
-L'Altitude issu du MNT
<br>
-le pH du sol obtenue à l'aide d'un pHmètre
<br>
-la teneur en eau du sol obtenue à partir de mesures de conductimétrie
<br>
-la pente des sites récupérée du MNT
<br>
-le SMOD (snow melting date) exprimé en tant qu'isoclines moyennes de la fonte des neiges en jours juliens (1 étant l'isocline de déneigement la plus précoce et 8 étant l'isocline de déneigement la plus tardive). Les dates de fonte des neiges ont été documentées à partir d'une enquête réalisée au cours des années 1997-1999. Même si les données sont antérieures aux autres données abiotiques, elles ont été conservées comme proxy topographique afin d'identifier les habitats typiques des combes à neige.
<br>

# AFC du tableau des espèces
## Représentation graphique de l'AFC

Une AFC est réalisée sur les données associées au tableau des espèces.

```{r, fig.show='hold', message=FALSE, warning=FALSE, echo=FALSE, fig.cap="Figure 1: AFC du tableau des espèces"}
coa1 <-dudi.coa(spe, scannf=FALSE, nf=2)
par(mfrow=c(2,1))
s.label(coa1$co, clabel=0.7)
s.label(coa1$li, clabel=0.7)
```

Le pourcentage de variance expliqué par l'AFC est présenté sur la figure 2. Il faut additionner 5 axes pour pouvoir expliquer 55% de la variance observée.

```{r, fig.show='hold', message=FALSE, warning=FALSE, echo=FALSE, fig.cap="Figure 2: % de variance expliqué par l'AFC"}
fviz_screeplot (coa1) +
  geom_hline (yintercept = 12.5962292, linetype = 2, color = "red")
```

## Interprétation des résultats

On observe un étagement des espèces avec les espèces plutôt typiques des crêtes ventées situées en bas du graphique telles que Poa alpina, Carex myosuroides, Festuca violacea, Potentilla crantzii (Liberati et al 2019, Varricchione et al 2022). 
<br>
Les espèces plutôt typiques des combes à neige sont situées en haut du graphique  telles que Carex foetida ou Alchemilla pentaphyllea (Matteodo et al 2016, Liberati et al 2019).

# Analyse mixte du tableau abiotique
## Gestion des valeurs NA

La variable SMOC n'est pas transformée en facteur similairement à la méthode appliquée au sein de la publication (Choler, 2005).
<br>
Une valeur "NA" est présente dans le jeu de données. L'une des méthodes de gestion de données NA dans une ACP consiste à remplacer la valeur manquante par la moyenne de la variable.

```{r, message=FALSE, warning=FALSE, include=FALSE}
which(is.na(env),arr.ind=TRUE)
env2 <- env
```

```{r, message=FALSE, warning=FALSE}
env2[is.na(env2)] <- mean(env$TeneurEau, na.rm = T)
```

## Représentation graphique

Une analyse multivariée utilisant la fonction dudi.hillssmith est réalisée pour prendre en compte le fait que les variables du jeu de données soit à la fois factorielles et quantitatives. 
Le poids des axes de l'analyse multivariee mixte est pondéré par le poids des axes de l'AFC pour pouvoir réaliser l'étude de coinertie par la suite. En effet, la fonction "coinertia" requiert un poids des lignes identifiques pour les deux diagrammes de dualité.

```{r, fig.show='hold', message=FALSE, warning=FALSE, echo=FALSE, fig.cap="Figure 3: Analyse mixte du tableau abiotique"}
dudienv<-dudi.hillsmith(env2, scannf = FALSE, nf = 3, row.w=coa1$lw)
scatter(dudienv) 
par(mfrow=c(2,1))
s.label(dudienv$co, clabel=0.7) 
s.label(dudienv$li, clabel=0.7)
```
Le pourcentage de variance expliqué par l'analyse mixte est présenté sur la figure 4. 

```{r, fig.show='hold', message=FALSE, warning=FALSE, echo=FALSE, fig.cap="Figure 4: Variance expliquée par l'analyse mixte"}
plot(dudienv$eig, type = "b")
```

3 axes sont retenus selon la méthode du coude.

## Interprétation des résultats

Les quadrats situés en bas du graphique sont ceux avec une teneur en eau et un SMOD élevé et correspondent ainsi aux quadrats typiques des combes à neige. Les sols avec des SMOD tardifs sont généralement plus acides avec des pH faibles.
<br>
Les quadrats situés en haut du graphique correspondent aux crêtes ventés avec une altitude élevée, un pH élevé illustrant des sols plus basiques en raison des roches qui affleurent. 
<br>
Il est toutefois surprenant que les axes relatifs aux variables SMOD et pente ne soient pas plus opposés.

# Etude de coinertie
## Représentation graphique

```{r, echo=FALSE, include=TRUE}
coiner<-coinertia(coa1, dudienv, scannf = F, nf = 2)
```

```{r, fig.show='hold', message=FALSE, warning=FALSE, echo=FALSE, fig.cap="Figure 5: Coinertie entre l'AFC des espèces et l'analyse mixte des paramètres abiotiques"}
plot(coiner)
par(mfrow=c(2,1))
s.label(coiner$c1)
s.label(coiner$l1)
```
Le pourcentage de variance expliqué par la coinertie est présenté sur la figure 6. 
```{r, fig.show='hold', message=FALSE, warning=FALSE, echo=FALSE, fig.cap="Figure 6: Variance expliquée par la coinertie"}
plot(coiner$eig, type = "b")
inertia.dudi(coiner)
```

## Interprétation

L'axe 1 des paramètres abiotiques a été inversé. Pour les espèces, l'axe 2 a été inversée et l'axe 1 a subit une rotation de 90°C.
Les flêches qui indiquent ou se trouvaient les quadrats en fonction de l'environnement semblent se diriger vers l'exterieur donc ce sont plutot les variables environnementales qui discriminent les sites.
<br>
On va plutôt retrouver les espèces de combes à neige vers le bas du graphique et celles typiques des crêtes ventées vers le haut du graphique. Salix herbacea et Geum montanum, plutôt typiques des milieux de versant sont situés proches des espèces typiques des crêtes et qui pourrait être une conséquence des plus hautes températures observées qui engendreraient une remontée de certaines espèces.
<br>
Un élément reste surprenant: la pente et le SMOD sont corrélés ce qui est inatendu et peut peut être être expliqué par la microtopographie du site qui complique le relation linéaire attendue entre pente et SMOD.



